DJANGO: Autenticacao de formularios e alerta

1 - Criando nova app:

	O Alura Space é uma galeria de imagens com temática espacial, um ambiente colaborativo para que várias pessoas possam adicionar fotografias de corpos celestiais.

	Atualmente, apenas quem tem acesso ao admin consegue inserir novas imagens, ou seja, pessoas desenvolvedoras e administradoras desse sistema. Precisamos adicionar uma nova funcionalidade para realizar o cadastro e o login de novas pessoas usuárias, para que elas possam inserir imagens também. Portanto, vamos criar outra app no Django.

	Criaremos uma app chamada usuarios:

		python3 manage.py startapp usuarios

	Agora, na estrutura de arquivos, além da aplicação "galeria", também temos a aplicação "usuarios".

	Nosso próximo passo é adicionar a nova aplicação ao projeto. Vamos expandir a pasta "setup" (onde se encontra nosso projeto Python) e abrir o arquivo settings.py.

	Na pasta "usuarios", há um arquivo chamado apps.py, em que constam as configurações dessa nova aplicação. Logo, é deste arquivo que faremos a importação da referência em settings.py para indicar a nova aplicação.

	Em setup/settings.py, vamos adicionar a referência usuarios.apps.UsuariosConfig dentro de INSTALLED_APPS:

		INSTALLED_APPS = [
		    'django.contrib.admin',
		    'django.contrib.auth',
		    'django.contrib.contenttypes',
		    'django.contrib.sessions',
		    'django.contrib.messages',
		    'django.contrib.staticfiles',
		    'galeria.apps.GaleriaConfig',
		    'usuarios.apps.UsuariosConfig',
		]

	Outras boas praticas que tinhamos feito em galeria e faremos em usuarios.

	Criamos um urls.py dentro de usuarios e colocando os conteudos limpos de começo, igual de galeria/urls.py:

		usuarios/urls.py

			from django.urls import path

			urlpatterns = [

			]

	E dentro de setup/urls.py, vamos adicionar o urls de usuarios:

		setup/urls.py

				path('', include('usuarios.urls')),

			Ficando:

				from django.contrib import admin
				from django.urls import path, include
				from django.conf import settings
				from django.conf.urls.static import static


				urlpatterns = [
				    path('admin/', admin.site.urls),
				    path('', include('galeria.urls')),
				    path('', include('usuarios.urls')),
				] + static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)

	Para finalizar, vamos entender por que optamos por criar uma aplicação "usuarios", em vez de gerar uma nova página.

	A divisão em apps fica a critério da pessoa desenvolvedora. Como implementaremos muitas funcionalidades acerca de usuários (como cadastro, login e autenticação), julgamos ser coerente ter duas aplicações distintas. A aplicação "galeria" para focar na inserção de novas fotografias e a aplicação "usuarios" para cuidar de processos relativos às pessoas usuárias.


2 - URLs e Views

	Agora, vamos desenvolver as páginas para fazer login, logout e cadastro de novas pessoas usuárias.

	Primeiramente, é preciso ter uma URL para acessar uma página.

	Vamos abrir o arquivo "usuarios > urls.py" e incluir URLs que façam referência às novas páginas que vamos criar. Criando primeiramente login e cadastro de usuarios, e importando da views os metodos.

		from django.urls import path
		from usuarios.views import login, cadastro, logout

		urlpatterns = [
		    path('login', login, name="login"),
		    path('cadastro', cadastro, name="cadastro"),
		]

	Em usuarios/views.py

		from django.shortcuts import render

		def login(request):
		    return render(request, 'usuarios/login.html')

		def cadastro(request):
		    return render(request, 'usuarios/cadastro.html')

	Criando os templates no novo diretorio criado agora templates/usuarios:

		templates/usuarios/login.html
		templates/usuarios/cadastro.html


3 - Templates

	Para termos acesso ao login e cadastro, vamos adicionar os links no menu do index:

		templates/galeria/partials/_menu.html

			<!-- <a href="#"><img src="{% static '/assets/ícones/1x/Mais vistas - inativo.png' %}"> Mais vistas</a> -->
            <a href="{% url 'login' %}"><img src="{% static '/assets/ícones/1x/Mais vistas - inativo.png' %}"> Login</a>
            <a href="{% url 'cadastro' %}"><img src="{% static '/assets/ícones/1x/Mais vistas - inativo.png' %}"> Cadastro</a>
            <a href="#"><img src="{% static '/assets/ícones/1x/Novas - inativo.png' %}"> Novas</a>

    Melhorar o login, com codigo pronto do professor:

    	templates/usuarios/login.html

				{% load static %}

				<!DOCTYPE html>
				<html lang="pt-br">

				<head>
				    <meta charset="UTF-8">
				    <meta http-equiv="X-UA-Compatible" content="IE=edge">
				    <meta name="viewport" content="width=device-width, initial-scale=1.0">
				    <title>Alura Space</title>
				    <link rel="preconnect" href="https://fonts.googleapis.com">
				    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
				    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
				    <!-- CSS only -->
				    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
				    <link rel="stylesheet" href="{% static '/styles/style.css' %}">
				</head>

				<body>
				    <div class="pagina-inicial">
				        <header class="cabecalho">
				            <img src="{% static '/assets/logo/Logo(2).png' %}" alt="Logo da Alura Space" />
				            <div class="cabecalho__busca">
				                <div class="busca__fundo">
				                    <form action="{% url 'buscar' %}">
				                        <input  class="busca__input" type="text" name="buscar" placeholder="O que você procura?">
				                        <button type="submit">
				                            <img class="busca__icone" src="{% static '/assets/ícones/1x/search.png' %}" alt="ícone de search">
				                        </button>
				                    </form>
				                </div>
				            </div>
				        </header>
				        <main class="principal">
				            <section class="menu-lateral">
				                <nav class="menu-lateral__navegacao">
				                    <a href="{% url 'index' %}"><img src="{% static '/assets/ícones/1x/Home - ativo.png' %}"> Home</a>
				                    <a href="{% url 'login' %}"><img src="{% static '/assets/ícones/1x/Mais vistas - inativo.png' %}"> Login</a>
				                    <a href="{% url 'cadastro' %}"><img src="{% static '/assets/ícones/1x/Novas - inativo.png' %}"> Cadastrar</a>
				                    <a href="#"><img src="{% static '/assets/ícones/1x/Surpreenda-me - inativo.png' %}"> Logout</a>
				                </nav>
				            </section>
				            <section class="galeria" style="margin-left: 5em">
				                <form action="" method="">
				                    <div class="row">
				                        <div class="col-12 col-lg-12" style="margin-bottom: 10px;">
				                            <label for="nome_login" style="color:#D9D9D9; margin-bottom: 5px;"><b>Nome de Login</b></label>
				                            <input type="text" class="form-control" name="nome_login" placeholder="Ex.: João Silva" required>
				                        </div>
				                        <div class="col-12 col-lg-12" style="margin-bottom: 10px;">
				                            <label for="password" style="color:#D9D9D9; margin-bottom: 5px;"><b>Senha</b></label>
				                            <input type="password" class="form-control" name="password" placeholder="Digite sua senha" required>
				                        </div>
				                        <div class="col-12 text-center">
				                            <button class="btn btn-success col-12" style="padding: top 5px;" type="submit">Login</button>
				                        </div>
				                    </div>
				                </form>
				            </section>
				        </main>
				    </div>
				</body>

				{% include 'galeria/partials/_footer.html' %}

		templates/usuarios/cadastro.html

				{% load static %}

				<!DOCTYPE html>
				<html lang="pt-br">

				<head>
				    <meta charset="UTF-8">
				    <meta http-equiv="X-UA-Compatible" content="IE=edge">
				    <meta name="viewport" content="width=device-width, initial-scale=1.0">
				    <title>Alura Space</title>
				    <link rel="preconnect" href="https://fonts.googleapis.com">
				    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
				    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
				    <!-- CSS only -->
				    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
				    <link rel="stylesheet" href="{% static '/styles/style.css' %}">
				</head>

				<body>
				    <div class="pagina-inicial">
				        <header class="cabecalho">
				            <img src="{% static '/assets/logo/Logo(2).png' %}" alt="Logo da Alura Space" />
				            <div class="cabecalho__busca">
				                <div class="busca__fundo">
				                    <form action="{% url 'buscar' %}">
				                        <input  class="busca__input" type="text" name="buscar" placeholder="O que você procura?">
				                        <button type="submit">
				                            <img class="busca__icone" src="{% static '/assets/ícones/1x/search.png' %}" alt="ícone de search">
				                        </button>
				                    </form>
				                </div>
				            </div>
				        </header>
				        <main class="principal">
				            <section class="menu-lateral">
				                <nav class="menu-lateral__navegacao">
				                    <a href="{% url 'index' %}"><img src="{% static '/assets/ícones/1x/Home - ativo.png' %}"> Home</a>
				                    <a href="{% url 'login' %}"><img src="{% static '/assets/ícones/1x/Mais vistas - inativo.png' %}"> Login</a>
				                    <a href="{% url 'cadastro' %}"><img src="{% static '/assets/ícones/1x/Novas - inativo.png' %}"> Cadastrar</a>
				                    <a href="#"><img src="{% static '/assets/ícones/1x/Surpreenda-me - inativo.png' %}"> Logout</a>
				                </nav>
				            </section>
				            <section class="galeria" style="margin-left: 5em">
				                <form action="" method="">
				                    <div class="row">
				                        <div class="col-12 col-lg-12" style="margin-bottom: 10px;">
				                            <label for="nome_cadastro" style="color:#D9D9D9; margin-bottom: 5px;"><b>Nome completo</b></label>
				                            <input type="text" class="form-control" name="nome_cadastro" placeholder="Ex.: João Silva" required>
				                        </div>
				                        <div class="col-12 col-lg-12" style="margin-bottom: 10px;">
				                            <label for="email" style="color:#D9D9D9; margin-bottom: 5px;"><b>Email</b></label>
				                            <input type="email" class="form-control" name="email" placeholder="Ex.: joaosilva@xpto.com" required>
				                        </div>
				                        <div class="col-12 col-lg-6" style="margin-bottom: 10px;">
				                            <label for="password1" style="color:#D9D9D9; margin-bottom: 5px;"><b>Senha</b></label>
				                            <input type="password" class="form-control" name="password1" placeholder="Digite sua senha" required>
				                        </div>
				                        <div class="col-12 col-lg-6" style="margin-bottom: 10px;">
				                            <label for="password2" style="color:#D9D9D9; margin-bottom: 5px;"><b>Confirmação de senha</b></label>
				                            <input type="password" class="form-control" name="password2" placeholder="Digite sua senha mais uma vez" required>
				                        </div>
				                        <div class="col-12 text-center">
				                            <button class="btn btn-success col-12" style="padding: top 5px;" type="submit">Criar sua conta</button>
				                        </div>
				                    </div>
				                </form>
				            </section>
				        </main>
				    </div>
				</body>

				{% include 'galeria/partials/_footer.html' %}


	Login com campos de usuario e senha, e cadastro: Nome, email, senha, repetir senha.

4 - Criando Formulários

	Na última aula criamos formulários de login e cadastro e adicionamos essa funcionalidade no nosso site.

	Mas, será que essa é a forma mais eficiente de utilizar formulários do Django?

	Em frameworks como o Django encontramos ferramentas que ajudam em diversas funcionalidades, como os formulários que são muito importantes no desenvolvimento web.

	O que faremos então é descobrir uma forma mais eficiente de criar e utilizar formulários no Django por meio das suas extensões.

	Vamos criar um arquivo chamado "forms.py" dentro de usuarios:

		usuarios/forms.py

	Dentro dele criamos uma classe chamada LoginForms herdando forms.Form de django.
	Criamos a variavel nome_login, que será o nome do usuario, e a Label, é o que vem antes do input <label for="nome_login" style="color:#D9D9D9; margin-bottom: 5px;"><b>Nome de Login</b></label>. Necessário colocar este campo required=True e o tamanho maximo de 100 caracteres.
	Criamos outra variavel chamada senha, com os mesmos parametros da primeira mas o campo nao é charfield, e sim senha, entao colocamos no widget (permite a edição de algumas caracteristicas do input), add forms.PasswordInput()


			from django import forms


			class LoginForms(forms.Form):
			    nome_login = forms.CharField(
			        label='Nome de Login',
			        required=True,
			        max_length=100)

			    senha = forms.CharField(
			        label='Senha',
			        required=True,
			        max_length=70,
			        widget=forms.PasswordInput())

	E vamos passar essa form para a views de usuarios:

		usuarios/views.py

			from usuarios.forms import LoginForms

			def login(request):
			    form = LoginForms()
			    return render(request, 'usuarios/login.html', {'form': form})

	Importando e instanciando a form, e passando dentro do dicionario.

	Dentro de templates/usuarios/login.html vamos colocar a form.

		        <form action="" method="">
                    {% csrf_token %}
                    <div class="row">
                        {% for field in form.visible_fields %}
                            <div>
                                <label for="{{ field.id_for_label }}">{{field.label}}</label>
                                {{ field }}
                            </div>
                        {% endfor %}
                    </div>
                </form>

	csrf_token é para colocar os dados da form com segurança, e ele disse que vai ter mais conteudo extra sobre. visible_fields siginifica que são os campos que vao ser visiveis para o usuario, onde podemos esconder campos.

	Mostrou os campos mas bem feio ainda, nao da pra ver os labels em preto em fundo azul escuro, a formatação ta tudo pra esquerda.


5 - Estilizando formulário

		Criando o botão de submit dentro da form criada em login:

			templates/usuarios/login.html